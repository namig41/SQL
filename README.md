# SQL
Лабораторная работа № 1
1. Из файла «Data_for_lab_AM_17_06.xlsx» сделать файлы, соответствующие листам в
электронной таблице. Каждый файл сохранить в текстовом формате «csv».
Разобраться со смыслом данных в таблице.
2. Создать базу данных для работы с помощью утилиты PgAdmin, либо другим
альтернативным вариантом (допускается использование не СУБД PostgreSQL).
3. Создать и запустить запрос на создание таблиц в базе дынных, содержащихся в
файлах «csv». Первичные и внешние ключи не создавать.
4. Создать и запустить запрос на импортирование данных из «csv» файлов в таблицы
базы данных.
5. Посмотреть описание оператора «ALTER TABLE». Создать и запустить запрос на
создание первичных и внешних ключей и дополнительных ограничений в таблицах.
Продумать логически режимы на изменение и удаление данных связанных с
ключами.

Лабораторная работа № 2
По данным из первой лабораторной работы реализовать следующие запросы:
1. Вывести всю информацию о станциях, id которых начинаются и
заканчиваются одной и той же цифрой.
2. Вывести информацию о станциях (id, название), название которых состоят
из не менее 8 символов (включая пробелы и дефисы между составными
названиями) и содержат не менее двух букв «о».
3. Из таблицы «dislocation» вывести следующие данные: ид станции, тип
вагона, время ожидания. Не должно быть одинаковых строк в результате.
Результат отсортировать по убыванию времени ожидания.
4. Вывести всю информацию о любых семи разных маршрутах со станции
«Бирюсинск», стоимостью не менее 7000.
5. Из таблицы «orders» вывести: id заявки, доход от вагона, число вагонов,
суммарный доход, время разгрузки, если число вагонов от 20 до 30, или 71,
или 20.
6. Вывести id заявок, для которых неизвестна обязательность выполнения.
7. Проверить, есть ли в таблице «stations» ячейки, в которых отсутствует
значение.
8. Удалить из таблицы «dislocation» кортеж, для которого id расположения
равен 666. Вставить в таблицу dislocation данные (id расположения
пропущен, сделать чтобы ид расположения добавлялся автоматически):
(971201,0,1,1,1,7), (921202,2,1,1,1,6), (843408,1,1,1,1,6), (843408,1,1,1,1,6).
Создать в базе таблицу «пустые вагоны» со следующими атрибутами:
количество вагонов, тип вагона, время ожидания, период, id станции.
Заполнить ее, исходя из исходных данных в базе (таблица «dislocation»).
Предложить способы проверки (и проверить) на наличие одинаковых
комбинаций значение составного атрибута: тип вагона, период, id станции.
9. Для станций с ненулевым минимальным количеством вагонов увеличить
стоимость простоя на 20 процентов.

Лабораторная работа № 3
1. Вывести названия станции с минимальной и максимальной ценой простоя с указанием
цены.
2. Для каждого id станции, с минимум двумя нулями в id, вывести период, среднее по
периоду количество загруженных вагонов, среднее по периоду количество незагруженных
вагонов и их сумму (таблица «dislocation»). Вывод отсортировать по убыванию периода.
Столбец с суммой не должен содержать нулей.
3. Для каждого периода вывести количество различных станций, соответствующих
периоду, среднее по периоду число вагонов, при условии, что среднее по периоду число
вагонов отличается от максимального среднего по периоду числа вагонов не более, чем на
5 (таблица «dislocation»).
4. Вывести названия станций, которые не встречаются в начальном пункте отправления
заявок.
5. Вывести названия станция из конечных пунктов заявок, для которых все заявки имеют
стоимость более 7700.
6. Вывести объединенное имя стаций всех заявок (например, «Станция1_to_Станция_2»),
для которых в расписании найдется период с количеством вагонов из интервала от 29 до
7. Создайте таблицу с числом строк более 1000000 и продемонстрируйте, что доступ к
индексированным полям осуществляется быстрее, нежели к неиндексированным. У
таблицы должен быть первичный ключ.

Лабораторная работа № 4
1. Создать таблицу: название станции (с четырьмя гласными буквами) и
соответствующее название отделения. Заполнить таблицу. (Используемые
таблицы:otdelenies, stations, stations_otdelenies)
2. Вывести следующую таблицу, состоящую из двух столбцов:
name_road_or_otdel и name_station. В первом столбце находятся названия всех
дорог и отделений, а во втором – название соответствующей станции. На каждую
дорогу и отделение выводить не более 2-х названий станций.
3. Вывести всевозможные пары станций и количество маршрутов для них,
первая станция – начало маршрута, вторая станция – конец маршрута. Столбцы при
выводе назвать: start_st, finish_st, num_routes. (Используемые таблицы:routes,
stations)
4. Вывести количество станций, сумму длин названий станций для каждого
времени ожидания от 0 до 20 включительно. Сортировка по убыванию количества
букв. (Используемые таблицы: dislocation, stations)
5. Сделать запросы со всеми известными вами типами JOIN для таблиц
stations и dislocation (предварительно добавить в таблицы кортежи (7777,Горки1,0,600,600) и (5555,337755,0,1,1,1,21) соответственно). Проверить, есть ли станции
без дислокации. Если имеются, то удалить такие записи.
6. Создать таблицу copy_stations (копию таблицы stations) и удалить в ней все
строки с одинаковым значением поля max.
7. Отобрать для каждой станции из таблицы dislocation по 5 маршрутов (по
возможности) с наибольшей стоимостью на обязательные и необязательные заявки
(станция дислокации = станция отправления маршрута, станция отправления
заявки = станция назначения маршрута).
8. Вывести ID расположения, имя станции и количество отобранных
маршрутов из 7).
9. Для каждой станции назначения во всех заявках отобрать по 5 маршрутов
(по возможности) на обязательные и необязательные заявки (станция назначения
базовой заявки = станция отправления маршрута, станция отправления другой
заявки = станция назначения маршрута).
10. Вывести ID заявки, имя станции назначения заявки и количество
отобранных маршрутов из 9).
11. Выполнить проверку на наличие маршрутов для всех обязательных
заявок: если будут заявки без маршрутов, то выбрать до 5 маршрутов (по
возможности) на эту заявку со станций дислокации и со станций прихода заявок
(станция дислокации = станция отправления маршрута, станция отправления
заявки = станция назначения маршрута или конечная станция другой заявки =
станция отправления маршрута, станция отправления заявки = станция назначения
маршрута).
12. Вывести ID заявок и количество соответствующих отобранных
маршрутов из 11)
13. Вывести в отдельную таблицу отобранные маршруты в запросах,
указанных выше (7, 9, 11). Создать новое поле – номер п/п маршрута. Проверить на
наличие дубликатов маршрутов

